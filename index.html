<!DOCTYPE html>
<html>
    <head>
        <title></title>
    </head>
    <body>
        <select id="accounts_list"></select>
        <input id="messageInput" name="amount" type="text" value="" placeholder="Message"/>
        <button id="submit" onclick="setMessage()">Vai filh√£o</button>

        <script type="application/javascript" src="web3.min.js"></script>
        <script type="application/javascript">
         if (typeof web3 !== 'undefined') {
             web3 = new Web3(web3.currentProvider);
         } else {
             // set the provider you want from Web3.providers
             web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
         }
         if (web3.isConnected) { console.log('YAY CONNECTED TO PARITY') }
         else { console.error('CANT CONNECT TO PARITY') }

         function populateAccounts(accounts){
             var opts = "";
             for(var i in accounts) {
                 opts += '<option>'+accounts[i]+'</option>';
             }
             document.getElementById('accounts_list').innerHTML = opts
         }

         function setMessage() {
             var selectedAccount = document.getElementById('accounts_list').value
             if (!selectedAccount) { console.error('no account selected'); return }

             var messageInput = document.getElementById('messageInput').value
             console.log('called ' + messageInput)
             contract.setMessage(messageInput, {value: contract.fee(), from: selectedAccount }, function (error, result) {
                 if (error) { console.error(error); return }
                 alert('posted')
             })
         }

         abiString = `[{"constant":false,"inputs":[{"name":"_message","type":"string"}],"name":"setMessage","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getMessage","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"fee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"message","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_fee","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[],"name":"UpdateMessage","type":"event"}]`
         abi = JSON.parse(abiString)
         address = '0xaD98e5f4d62d0cE3E57C1b7DBFD50846d649b9Db'
         contract = web3.eth.contract(abi).at(address)

         event = contract.UpdateMessage()
         event.watch(function (error, message) {
             contract.message(function (error, result) { alert(result) })
         })

         populateAccounts(web3.eth.accounts)
        </script>
    </body>
</html>
